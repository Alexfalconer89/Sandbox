{"job":{"components":{"197108":{"id":197108,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-159239741,"x":-224,"y":0,"width":32,"height":32,"inputConnectorIDs":[197115],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send SQS"}}}},"visible":true},"2":{"slot":2,"name":"Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Queue Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SQSClient}_reporting.fifo"}}}},"visible":true},"4":{"slot":4,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database} REPORT Emmasdiary"}}}},"visible":true},"5":{"slot":5,"name":"Message Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Plain"}}}},"visible":true},"6":{"slot":6,"name":"Message Group Id","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database}ReportTrigger"}}}},"visible":true},"7":{"slot":7,"name":"Message Deduplication Id","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DateForQueue.now().format(\"yyyyMMddHHmmssSSS\")}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"197109":{"id":197109,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[197114],"outputSuccessConnectorIDs":[197115],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create extract tables"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- emmas_diary\ncreate or replace table ${Database}.temp.emmas_diary_report_run\nas\nselect\n    year(x.reg_date) as reg_year,\n    monthname(x.reg_date) as reg_month,\n    count(distinct name_urn) as total_supplied,\n    count(distinct decode(result,'new',name_urn)) as new_total,\n    cast(count(distinct decode(result,'new',name_urn)) as decimal(10,4))/cast(count(distinct name_urn) as decimal(10,4)) as new_perc,\n    count(distinct decode(result,'duplicate',name_urn)) as dupe_total,\n    cast(count(distinct decode(result,'duplicate',name_urn)) as decimal(10,4))/cast(count(distinct name_urn) as decimal(10,4)) as dupe_perc,\n    count(distinct case when cat = 1 and dog = 0 then name_urn end) as cat_owners_total,\n    cast(count(distinct case when cat = 1 and dog = 0 then name_urn end) as decimal(10,4))/cast(count(distinct name_urn) as decimal(10,4)) as cat_owners_perc,\n    count(distinct case when cat = 0 and dog = 1 then name_urn end) as dog_owners_total,\n    cast(count(distinct case when cat = 0 and dog = 1 then name_urn end) as decimal(10,4))/cast(count(distinct name_urn) as decimal(10,4)) as dog_owners_perc,\n    count(distinct case when cat = 1 and dog = 1 then name_urn end) as both_owners_total,\n    cast(count(distinct case when cat = 1 and dog = 1 then name_urn end) as decimal(10,4))/cast(count(distinct name_urn) as decimal(10,4)) as both_owners_perc\nfrom (\n         select distinct\n             n.name_urn,\n             n.reg_date,\n             case\n                 when prev_rec.data_date < n.reg_date then 'duplicate'\n                 else 'new'\n             end as result,\n             max(case when question_id = 99 and answer = 'Y' then 1 else 0 end) over(partition by n.name_urn) as cat,\n             max(case when question_id = 100 and answer = 'Y' then 1 else 0 end) over(partition by n.name_urn) as dog\n         from ${Database}.live.names n\n         left join (\n                       select distinct\n                           cid,\n                           first_value(data_date) over\n                               (\n                                   partition by cid\n                                   order by data_date asc\n                               ) as data_date\n                       from ${Database}.live.names\n                       where source <> 'REG_EMMAS_DIARY'\n                           and source_data_controller_id = 5\n                   ) prev_rec on prev_rec.cid = n.cid\n         left join ${Database}.db.question q on n.name_urn = q.name_urn\n                                       and q.question_id in (99,100)\n         where n.source = 'REG_EMMAS_DIARY'\n     ) x\nwhere next_day (x.reg_date - 7,'monday')  <> '2020-06-01'\ngroup by 1,2\norder by 1 desc;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"197110":{"id":197110,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-400,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[197114],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"197115":{"id":197115,"sourceID":197109,"targetID":197108}},"failureConnectors":{},"unconditionalConnectors":{"197114":{"id":197114,"sourceID":197110,"targetID":197109}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"Emmas_diary_monthy_report","description":"","type":"ORCHESTRATION","tag":"4900b054-402a-4853-8d0c-093724a762d9"}}