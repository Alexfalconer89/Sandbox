{"job":{"components":{"196481":{"id":196481,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-304,"y":-48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[196498],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196484":{"id":196484,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-192,"y":-48,"width":32,"height":32,"inputConnectorIDs":[196498],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[196493],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SetupExtractDate"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select to_char(max(ExtractDate),'YYYY/MM/DD') as DataDate\nfrom (select max(created_date) as ExtractDate from ${Database}.db.NHSC_NPLUSHUB_FULLREG where source_Date<current_date()\n     union\n     select to_date('01/12/2019','DD/MM/YYYY'))\n     "}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DataDate"},"2":{"slot":2,"type":"STRING","value":"DATADATE"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196485":{"id":196485,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":256,"y":-48,"width":32,"height":16,"inputConnectorIDs":[196494],"outputSuccessConnectorIDs":[196495],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHScNplusHub_DataUID"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UID"},"2":{"slot":2,"type":"STRING","value":"DataUID"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"7":{"slot":7,"name":"Stop on Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"8":{"slot":8,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":false},"9":{"slot":9,"name":"Condition","elements":{},"visible":false},"10":{"slot":10,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"11":{"slot":11,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[196499],"inputIterationConnectorIDs":[]},"196486":{"id":196486,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1214167305,"x":-64,"y":-48,"width":32,"height":32,"inputConnectorIDs":[196493],"outputSuccessConnectorIDs":[196492],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retrieve Updated Users"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSc_NplusHub_F5API_LIVE"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"uid"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Items"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"Success"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT ..."}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"8000"}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Other"},"2":{"slot":2,"type":"STRING","value":"DataDate=${DataDate}"}}}},"visible":true},"13":{"slot":13,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database}"}}}},"visible":true},"14":{"slot":14,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"STAGING"}}}},"visible":true},"15":{"slot":15,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSC_NPLUSHUB_USERS"}}}},"visible":true},"16":{"slot":16,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"17":{"slot":17,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Bucket}"}}}},"visible":true},"18":{"slot":18,"name":"Primary Keys","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REST"}}}},"visible":false},"100":{"slot":100,"name":"Profile","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSc NplusHub F5 API"}}}},"visible":true},"499":{"slot":499,"name":"Authentication Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Other"}}}},"visible":true},"500":{"slot":500,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"501":{"slot":501,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"502":{"slot":502,"name":"Bearer Token","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"503":{"slot":503,"name":"OAuth","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"504":{"slot":504,"name":"Key Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"505":{"slot":505,"name":"Key Value","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"506":{"slot":506,"name":"Add Authorization To","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Request Header"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"3"}}}},"visible":false},"1992":{"slot":1992,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1993":{"slot":1993,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"1994":{"slot":1994,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1995":{"slot":1995,"name":"Stage Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1996":{"slot":1996,"name":"Stage Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1997":{"slot":1997,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1998":{"slot":1998,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1999":{"slot":1999,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"2000":{"slot":2000,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"40501":{"slot":40501,"name":"","elements":{},"visible":false},"40502":{"slot":40502,"name":"Load Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"Gzip"}}}},"visible":true},"63319":{"slot":63319,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":false},"63320":{"slot":63320,"name":"Storage Account","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63321":{"slot":63321,"name":"Blob Container","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63322":{"slot":63322,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"84533":{"slot":84533,"name":"Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88340":{"slot":88340,"name":"","elements":{},"visible":false},"88341":{"slot":88341,"name":"Staging","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Existing Amazon S3 Location"}}}},"visible":true},"88342":{"slot":88342,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":true},"88343":{"slot":88343,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88344":{"slot":88344,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"88345":{"slot":88345,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"98776":{"slot":98776,"name":"GCS Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196487":{"id":196487,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":96,"y":-48,"width":32,"height":32,"inputConnectorIDs":[196492],"outputSuccessConnectorIDs":[196494],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query Result To Grid 0"}}}},"visible":true},"2":{"slot":2,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NESTLE"}}}},"visible":true},"4":{"slot":4,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSC_NPLUSHUB_USERS"}}}},"visible":true},"6":{"slot":6,"name":"Table Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Items"}}}},"visible":true},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select cast(\"uid\" as integer) as UID\nfrom \n    ${Database}.staging.NHSC_NplusHub_users\nwhere is_integer(to_number(\"uid\"))=1\n\n/*select to_number(replace(replace(r.value::string,'{\"uid\":\"',''),'\"}','')) as UID\nfrom \n    ${Database}.staging.NHSC_NplusHub_users a,\n    lateral flatten(input=>split(replace(replace(\"Items\",'[',''),']',''),',')) r\nwhere is_integer(to_number(replace(replace(r.value::string,'{\"uid\":\"',''),'\"}','')))=1\n*/\n"}}}},"visible":false},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHScNplusHub_DataUID"}}}},"visible":true},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UID"}}}},"visible":true},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"5000"}}}},"visible":true},"11":{"slot":11,"name":"Order By","elements":{},"visible":true},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":true},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":true},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"STAGING"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196488":{"id":196488,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":560,"y":-48,"width":32,"height":32,"inputConnectorIDs":[196489],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Log as File Load"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into tbw.db.monitoring\n(monitoring_timestamp,client,process,description,file_name,sub_description,value)\nselect\n    current_timestamp::timestamp_ntz,\n    '${Database}',\n    'LOAD',\n    'REG_NHSC_NPLUS',\n    'nhsc_nplushub_${DataDate}_'||to_char(current_date(),'YYYYMMDD')||'.api',\n    'COUNT',\n    to_char(records)\nfrom (\n         select\n             'registration' as file,\n             count(*) as records\n         from ${Database}.db.nhsc_nplushub_fullreg\n         where source_date=current_date()\n     ) a\nwhere records > 0;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196490":{"id":196490,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":256,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"DataUID","mapTo":"DataUID"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSc NplusHub FullReg 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NHSc NplusHub FullReg"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DataUID"},"2":{"slot":2,"type":"STRING","value":"${DataUID}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[196499]},"196491":{"id":196491,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":416,"y":-48,"width":32,"height":32,"inputConnectorIDs":[196495],"outputSuccessConnectorIDs":[196489],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Map to db"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into ${Database}.db.names\n    (\n        bbw_urn,\n        name_urn,\n        data_date,\n        reg_date,\n        title,\n        firstname,\n        lastname,\n        job_title,\n        company,\n        add1,\n        add2,\n        add3,\n        add4,\n        add5,\n        add6,\n        add7,\n        city,\n        state,\n        postcode,\n        country,\n        region,\n        dob,\n        gender,\n        phone_work,\n        phone_mobile,\n        phone_home,\n        phone_fax,\n        email,\n        www,\n        fullname,\n        initials,\n        source,\n        source_file,\n        source_urn,\n        source_date,\n        source_data_controller_id,\n        source_brand_id\n    ) \n    select distinct\n        cast(cast(row_number() over(order by 1) as int) + nvl((select max(bbw_urn) from ${Database}.db.names),0) as int) as bbw_urn,\n        name_urn,\n        updated_date,\n        created_date,\n        coalesce(honorific,''), --title\n        coalesce(left(first_name, 50),''),\n        coalesce(left(last_name, 50),''),\n        coalesce(left(speciality,50),''), --job title\n        '',        \n        coalesce(number,''),\n        coalesce(street,''),\n        '',\n        '',\n        '',\n        '',\n        '',\n        coalesce(city,''),\n        coalesce(state,''),\n        coalesce(postcode,''),\n        coalesce(country,''),\n        '',\n        birth,\n        '', --gender, should this be 'U'?\n        '',\n        '',\n        '',\n        '',\n        coalesce(mail,''),\n        '',\n        '',\n        '',      \n        'REG_NHSC_NPLUS',\n        'nhsc_nplushub_${DataDate}_'||to_char(current_date(),'YYYYMMDD')||'.api',\n        uid as source_urn,\n        current_date(),\n        nvl((select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd'),-1) as data_controller_id,\n        nvl((select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals'),-1) as brand_id\n    from ${Database}.db.nhsc_nplushub_fullreg\n    where source_date=current_date()\n;\n\ninsert into ${Database}.db.names_attributes\n(\n    name_urn,\n    data_date,\n    userid,\n    job_role,\n    registration_campaign,\n    source,\n    source_file,\n    source_urn,\n    source_date\n)\n    select \n        name_urn,\n        updated_date as data_date,\n        uid as userid,\n        speciality as job_role,\n        'NHSc N+Hub' as registration_campaign,    \n        source,\n        source_file,\n        uid as source_urn,\n        source_date\n    from ${Database}.db.nhsc_nplushub_fullreg\n    where source_date=current_date()\n;\n\ninsert into ${Database}.db.names_dp\n    (\n        name_urn,\n        data_controller_id,\n        brand_id,\n        data_date,\n        dp_date,\n        dp_mailable,\n        dp_emailable,\n        dp_phoneable,\n        dp_smsable,\n        source,\n        source_file,\n        source_urn,\n        source_date\n    ) \n    select \n        concat('REG_NHSC_NPLUS|',uid),\n        nvl((select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd'),-1),\n        nvl((select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals'),-1)  as brand_id,\n        updated_date,\n        updated_date,\n        case when optin = 'true' then 1 else 0 end, \n        case when optin = 'true' then 1 else 0 end, \n        cast(null as int), \n        cast(null as int), \n        'REG_NHSC_NPLUS',\n        'nhsc_nplushub_${DataDate}_'||to_char(current_date(),'YYYYMMDD')||'.api',\n        uid as source_urn,\n        current_date()\n    from ${Database}.db.nhsc_nplushub_fullreg\n    where source_date=current_date()\n;\n\ninsert into ${Database}.db.names_preference\n    (\n        name_urn,\n        data_controller_id,\n        division_id,\n        brand_id,\n        data_date,\n        pref_id,\n        pref_mailable,\n        pref_emailable,\n        pref_phoneable,\n        pref_smsable,\n        source,\n        source_file,\n        source_urn,\n        source_date\n    ) \n    select distinct \n      name_urn,\n      nvl((select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd'),-1) as data_controller_id,\n      cast(null as int) as division_id,\n      nvl((select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals'),-1)  as brand_id,\n      updated_date as data_date,\n      cast(null as int) as pref_id,\n      first_value(case when optin = 'true'then 1 else 0 end) over(partition by uid order by updated_date desc)  as pref_mailable,\n      first_value(case when optin = 'true'then 1 else 0 end) over(partition by uid order by updated_date desc) as pref_emailable,\n      cast(null as int) as pref_phoneable, \n      cast(null as int) as pref_smsable, \n      'REG_NHSC_NPLUS' as source,\n      'nhsc_nplushub_${DataDate}_'||to_char(current_date(),'YYYYMMDD')||'.api' as source_file,\n      uid as source_urn,\n      current_date() as source_date\n    from ${Database}.db.nhsc_nplushub_fullreg\n    where source_date=current_date()\n;\n\ninsert into ${Database}.db.question\n(\n    name_urn,\n    data_controller_id,\n    brand_id,\n    question_id,\n    answer,\n    data_date,\n    source,\n    source_file,\n    source_urn,\n    source_date\n)\n    select \n        name_urn,\n        (select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd') as data_controller_id,\n        (select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals') as brand_id,\n        (select question_id from ${Database}.db.ref_question where question = 'NHSc patients') as question_id,\n        patients as answer,  \n        updated_date as data_date,\n        source,\n        source_file,\n        uid as source_urn,\n        source_date\n    from ${Database}.db.nhsc_nplushub_fullreg\n    where source_date=current_date()\n      and patients is not null\n    union\n    select \n        name_urn,\n        (select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd') as data_controller_id,\n        (select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals') as brand_id,\n        (select question_id from ${Database}.db.ref_question where question = 'NHSc interest categories') as question_id,\n        replace(replace(replace(replace(t.value,']',''),'[',''),'{\"value\":\"',''),'\"}','') as answer,  \n        updated_date as data_date,\n        source,\n        source_file,\n        uid as source_urn,\n        source_date\n    from ${Database}.db.nhsc_nplushub_fullreg a,\n        table(strtok_split_to_table(interest_categories,',')) t\n    where source_date=current_date()\n      and a.interest_categories is not null\n    union\n    select \n        name_urn,\n        (select data_controller_id from ${Database}.db.ref_data_controller where data_controller = 'Vitaflo (International) Ltd') as data_controller_id,\n        (select brand_id from ${Database}.db.ref_brand where brand like 'Nestl_ Health Science Professionals') as brand_id,\n        (select question_id from ${Database}.db.ref_question where question = 'NHSc interest topics') as question_id,\n        replace(replace(replace(replace(t.value,']',''),'[',''),'{\"value\":\"',''),'\"}','') as answer,  \n        updated_date as data_date,\n        source,\n        source_file,\n        uid as source_urn,\n        source_date\n    from ${Database}.db.nhsc_nplushub_fullreg a,\n        table(strtok_split_to_table(interest_topics,',')) t\n    where source_date=current_date()\n      and a.interest_topics is not null\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"196489":{"id":196489,"sourceID":196491,"targetID":196488},"196492":{"id":196492,"sourceID":196486,"targetID":196487},"196494":{"id":196494,"sourceID":196487,"targetID":196485},"196495":{"id":196495,"sourceID":196485,"targetID":196491}},"failureConnectors":{},"unconditionalConnectors":{"196493":{"id":196493,"sourceID":196484,"targetID":196486},"196498":{"id":196498,"sourceID":196481,"targetID":196484}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"196499":{"id":196499,"sourceID":196485,"targetID":196490}},"noteConnectors":{},"notes":{},"variables":{"DataDate":{"definition":{"name":"DataDate","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2019/12/01"},"DataUID":{"definition":{"name":"DataUID","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"123"}},"grids":{"NHScNplusHub_DataUID":{"definition":{"name":"NHScNplusHub_DataUID","scope":"TASKBATCH","definitions":[{"name":"UID","type":"DECIMAL"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"NHSc NplusHub F5 API","description":null,"type":"ORCHESTRATION","tag":"9e26bb6f-730e-4b31-91c5-d67e704e2821"}}