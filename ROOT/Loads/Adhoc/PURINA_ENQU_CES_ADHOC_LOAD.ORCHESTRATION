{"job":{"components":{"196404":{"id":196404,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":-512,"y":32,"width":32,"height":32,"inputConnectorIDs":[196411],"outputSuccessConnectorIDs":[196410],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Convert Excel"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are exported into bash, but should be considered read-only: \n#    echo $myvar\n###\n\ncat > /tmp/carnivalconsent.py << END_OF_PYTHON\n\n\nimport boto3\nimport io\nimport pandas as pd\nfrom io import StringIO\nimport os\n\ns3 = boto3.resource('s3')\nfile_list = []\nmy_bucket = s3.Bucket('${Bucket}')\nfor my_bucket_object in my_bucket.objects.filter(Prefix='FTP/BBW_Purina/Purina_PCS/ToBW/'):\n\tif '.xlsx' in my_bucket_object.key :\n\t\tfile_list.append(my_bucket_object.key)\nprint(file_list)\n\n\ns3 = boto3.client('s3')\nfor file_ in file_list :\n\tprint(file_)\n\tobj = s3.get_object(Bucket='${Bucket}', Key=file_)\n#\tdf = pd.read_excel(obj['Body'])\n\tdf= pd.read_excel(io.BytesIO(obj['Body'].read()))\n\tdf = df[df.filter(regex='^(?!Unnamed)').columns]\n\tprint(df)\n\tcsv_buffer = StringIO()\n\tdf.to_csv(csv_buffer,index=0)\n\ts3_resource = boto3.resource('s3')\n\tfile_csv=(file_.replace('.xlsx','.csv')).replace('.','-',4)\n\ts3_resource.Object('${Bucket}', file_csv).put(Body=csv_buffer.getvalue())\n    #move xlsx\n\ts3_resource.Object('${Bucket}', 'data_in/PURINA_PCS/xlsx/'+os.path.basename(file_)).copy_from( CopySource='${Bucket}/'+file_)\n\t# Delete the former object A\n\ts3_resource.Object('${Bucket}', file_).delete()\n\n\n    \n\nEND_OF_PYTHON\npython3 /tmp/carnivalconsent.py\nrm /tmp/carnivalconsent.py"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196405":{"id":196405,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":103747008,"x":-401,"y":39,"width":32,"height":32,"inputConnectorIDs":[196410],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PURINA_ENQU_CES_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"bucket","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Bucket}"}}}},"visible":true},"3":{"slot":3,"name":"client","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database}"}}}},"visible":true},"4":{"slot":4,"name":"file_set","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PURINA_ENQU_CES_ADHOC"}}}},"visible":true},"5":{"slot":5,"name":"zip_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"6":{"slot":6,"name":"file_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"7":{"slot":7,"name":"file_group","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"8":{"slot":8,"name":"bucket_full","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"9":{"slot":9,"name":"files_zipped","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"10":{"slot":10,"name":"zip_extension","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"11":{"slot":11,"name":"zip_full_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"12":{"slot":12,"name":"files_in_folder","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"13":{"slot":13,"name":"bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"14":{"slot":14,"name":"file_set_pattern","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"15":{"slot":15,"name":"file_set_date_format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"16":{"slot":16,"name":"zip_full_bucket_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"17":{"slot":17,"name":"zip_full_name_bucket","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"18":{"slot":18,"name":"base_bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"19":{"slot":19,"name":"working_bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"20":{"slot":20,"name":"zip_name","elements":{},"visible":true},"21":{"slot":21,"name":"file_group","elements":{},"visible":true},"22":{"slot":22,"name":"tables_in_set","elements":{},"visible":true},"23":{"slot":23,"name":"tables_in_set_mapping","elements":{},"visible":true},"24":{"slot":24,"name":"full_set_required","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196407":{"id":196407,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-608,"y":32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[196411],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"196410":{"id":196410,"sourceID":196404,"targetID":196405}},"failureConnectors":{},"unconditionalConnectors":{"196411":{"id":196411,"sourceID":196407,"targetID":196404}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"PURINA_ENQU_CES_ADHOC_LOAD","description":"","type":"ORCHESTRATION","tag":"7c756ca3-de96-431b-9542-add001088919"}}