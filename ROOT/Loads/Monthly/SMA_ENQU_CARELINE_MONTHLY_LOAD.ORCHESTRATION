{"job":{"components":{"196101":{"id":196101,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-608,"y":32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[196104],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196103":{"id":196103,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":103747008,"x":-320,"y":32,"width":32,"height":32,"inputConnectorIDs":[196107],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SMA_ENQU_CARELINE_MONTHLY_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"bucket","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Bucket}"}}}},"visible":true},"3":{"slot":3,"name":"client","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database}"}}}},"visible":true},"4":{"slot":4,"name":"file_set","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SMA_ENQU_CARELINE_2_MONTHLY"}}}},"visible":true},"5":{"slot":5,"name":"zip_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"6":{"slot":6,"name":"file_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"7":{"slot":7,"name":"file_group","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"8":{"slot":8,"name":"bucket_full","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"9":{"slot":9,"name":"files_zipped","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"10":{"slot":10,"name":"zip_extension","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"11":{"slot":11,"name":"zip_full_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"12":{"slot":12,"name":"files_in_folder","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"13":{"slot":13,"name":"bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"14":{"slot":14,"name":"file_set_pattern","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"15":{"slot":15,"name":"file_set_date_format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"16":{"slot":16,"name":"zip_full_bucket_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"17":{"slot":17,"name":"zip_full_name_bucket","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"18":{"slot":18,"name":"base_bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"19":{"slot":19,"name":"working_bucket_directory","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true},"20":{"slot":20,"name":"zip_name","elements":{},"visible":true},"21":{"slot":21,"name":"file_group","elements":{},"visible":true},"22":{"slot":22,"name":"tables_in_set","elements":{},"visible":true},"23":{"slot":23,"name":"tables_in_set_mapping","elements":{},"visible":true},"24":{"slot":24,"name":"full_set_required","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"X"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196106":{"id":196106,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":-496,"y":32,"width":32,"height":32,"inputConnectorIDs":[196104],"outputSuccessConnectorIDs":[196107],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Convert careline Excel"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are exported into bash, but should be considered read-only: \n#    echo $myvar\n###\n\ncat > /tmp/smacareline.py << END_OF_PYTHON\n\nimport boto3\nimport io\nimport pandas as pd\nfrom io import StringIO\nimport os\n\n                   \n\ns3 = boto3.resource('s3')\nfile_list = []\nmy_bucket = s3.Bucket('${Bucket}')\nfor my_bucket_object in my_bucket.objects.filter(Prefix='FTP/BBW_Nestle/Nestle_SMA/Careline'):\n\tif '.xlsx' in my_bucket_object.key and 'BBW_Consumer_Data'  in my_bucket_object.key:\n\t\tfile_list.append(my_bucket_object.key)\nprint(file_list)\n\n\ns3 = boto3.client('s3')\nfor file_ in file_list :\n\tprint(file_)\n\tobj = s3.get_object(Bucket='${Bucket}', Key=file_)\n#\tdf = pd.read_excel(obj['Body'])\n\tdf= pd.read_excel(io.BytesIO(obj['Body'].read()),engine='openpyxl')\n\tdf = df[df.filter(regex='^(?!Unnamed)').columns]\n\tprint(df)\n\tcsv_buffer = StringIO()\n\tdf.to_csv(csv_buffer,index=0)\n\ts3_resource = boto3.resource('s3')\n\tfile_csv=file_.replace('.xlsx','.csv')\n\ts3_resource.Object('${Bucket}', file_csv).put(Body=csv_buffer.getvalue())\n \n    #move xlsx\n\ts3_resource.Object('${Bucket}', 'data_in/SMA_ENQU_CARELINE_2_MONTHLY/xlsx/'+os.path.basename(file_)).copy_from( CopySource='${Bucket}/'+file_)\n\t# Delete the former object A\n\ts3_resource.Object('${Bucket}', file_).delete()\n    \nEND_OF_PYTHON\npython3 /tmp/smacareline.py\nrm /tmp/smacareline.py"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"196107":{"id":196107,"sourceID":196106,"targetID":196103}},"failureConnectors":{},"unconditionalConnectors":{"196104":{"id":196104,"sourceID":196101,"targetID":196106}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"SMA_ENQU_CARELINE_MONTHLY_LOAD","description":"","type":"ORCHESTRATION","tag":"3585ac30-e239-45b4-a24c-b7df47798a21"}}