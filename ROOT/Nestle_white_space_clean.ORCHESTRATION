{"job":{"components":{"195920":{"id":195920,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":-195,"y":4,"width":32,"height":32,"inputConnectorIDs":[195924],"outputSuccessConnectorIDs":[195927],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Populate grid with SQL"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database}"}}}},"visible":true},"4":{"slot":4,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WHITESPACE_UPDATES"}}}},"visible":true},"6":{"slot":6,"name":"Table Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE_SQL"}}}},"visible":true},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trim_statements"}}}},"visible":true},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE_SQL"}}}},"visible":true},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"5000"}}}},"visible":true},"11":{"slot":11,"name":"Order By","elements":{},"visible":true},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":true},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TEMP"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"195921":{"id":195921,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-69,"y":-12,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${update_sql}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[195930]},"195922":{"id":195922,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-496,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[195925],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"195923":{"id":195923,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-307,"y":-4,"width":32,"height":32,"inputConnectorIDs":[195925],"outputSuccessConnectorIDs":[195924],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Generate SQL"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\n\ncreate or replace table ${Database}.temp.whitespace_updates as\nselect\n    'update ${Database}.db.'||table_name||' set '||x||where_clause as update_sql\nfrom\n(\n  select\n      table_name,\n      case when source_date_field + load_date_field > 0 then ' where '||case when source_date_field = 1 then 'source_date >= dateadd(''D'',-5,current_date())' else 'load_date >= dateadd(''D'',-5,current_date())' end else '' end as where_clause,\n  \t  --case when source_date_field + load_date_field > 0 then ' where '||case when source_date_field = 1 then 'source_date >= dateadd(''D'',-5,current_date())' else 'load_date >= dateadd(''D'',0,current_date())' end else '' end as where_clause,\n      listagg('\"'||column_name||'\"=trim(\"'||column_name||'\")',',') as x      \n  from\n  (\n    select distinct\n        istable.table_name,\n        istable.column_name,\n        case when sd.table_name is not null then 1 else 0 end as source_date_field,\n        case when ld.table_name is not null then 1 else 0 end as load_date_field\n    from ${Database}.information_schema.columns istable\n    left join \n        (\n        select \n            table_name\n        from ${Database}.information_schema.columns\n        where column_name ilike 'source_date'\n        ) sd on istable.table_name = sd.table_name\n    left join \n        (\n        select \n            table_name\n        from ${Database}.information_schema.columns\n        where column_name ilike 'load_date'\n        ) ld on istable.table_name = ld.table_name\n    where istable.table_schema = 'DB'\n      and istable.data_type = 'TEXT'\n      and not contains(istable.table_name,'_ARCHIVE')\n      and not contains(istable.table_name,'_OVERTHREEYEARS')\n      and not contains(istable.table_name,'_BACKUP')\n      and left(istable.table_name,3) <> 'VW_'\n  ) a\n  group by 1,2\n) b\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"195926":{"id":195926,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-69,"y":-12,"width":32,"height":16,"inputConnectorIDs":[195927],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Trim iterator"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trim_statements"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE_SQL"},"2":{"slot":2,"type":"STRING","value":"update_sql"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[195930],"inputIterationConnectorIDs":[]}},"successConnectors":{"195924":{"id":195924,"sourceID":195923,"targetID":195920},"195927":{"id":195927,"sourceID":195920,"targetID":195926}},"failureConnectors":{},"unconditionalConnectors":{"195925":{"id":195925,"sourceID":195922,"targetID":195923}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"195930":{"id":195930,"sourceID":195926,"targetID":195921}},"noteConnectors":{},"notes":{},"variables":{"update_sql":{"definition":{"name":"update_sql","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"trim_statements":{"definition":{"name":"trim_statements","scope":"BRANCH","definitions":[{"name":"UPDATE_SQL","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Nestle_white_space_clean","description":null,"type":"ORCHESTRATION","tag":"ef8e7b9c-fd1b-4258-bc80-f0739c6d50d0"}}