{"job":{"components":{"196692":{"id":196692,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":256,"y":0,"width":32,"height":32,"inputConnectorIDs":[196738],"outputSuccessConnectorIDs":[196696],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Nestle Create Body of Email"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select \n'<html>'\n||'<style>'\n||'th,'\n||'td {font-family: arial; font-size: 9pt; width: 50%; border: 1px inset;},'\n||'table {font-family: arial; font-size: 9pt; width: 50%; border: 1px outset;}'\n||'</style>'\n||'<head><head>'\n||'<body style = \"font-family: arial; font-size: 9pt;\">'\n||'<h1 style = \"font-family: arial; font-size: 24pt;\">Purina & Nestle Data Feeds Report</h1>'\n||'<h3 style = \"font-family: arial; font-size: 13.5pt;\">Feeds marked in red are more than two days overdue and need investigating.</h3>'\n||'</br>'\n||'<table><tr><th>Category</th><th>File</th><th>Frequency</th><th>Number of Files Last Month</th><th>Number of Files This Month</th><th>Days Since File Last Received</th><th>Date of Last File Successfully Loaded</th><th>Records Successfully Loaded</th></tr>'\n||listagg(\n             '<tr>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || category || '</td>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || latest_file || '</td>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || frequency || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || files_last_month || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || files_this_month || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || days_since_last_file || '</td>'\n             ||'<td style=\"text-align: left; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || last_load_date || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || records_loaded || '</td>'\n             ||'</tr>',\n             ' '\n         )\n  WITHIN GROUP (\n                   order by case\n                                when Frequency = 'Inactive' then 1\n                                else 0\n                            end,\n                            case\n                                when Frequency = 'Weekly' then days_since_last_file - 7\n                                when Frequency in ('Monthly','Adhoc') then days_since_last_file - 31\n                                else days_since_last_file\n                            end desc,\n                            case\n                                when Frequency = 'Daily' then 1\n                                when Frequency = 'Weekly' then 2\n                                when Frequency = 'Monthly' then 3\n                                when Frequency = 'Adhoc' then 4\n                                else 5\n                            end,\n                            category,\n                            latest_file\n               )\n||'</table>'\n||'</br></br>Please do not reply to this email as it comes from an automated account.</br></br>Thanks</body></html>'\nas email_body\nfrom (\n         select\n             *\n         from ${Database}.db.data_feeds_report\n         where client <> 'SMA'\n     ) a"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"email_body"},"2":{"slot":2,"type":"STRING","value":"EMAIL_BODY"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196693":{"id":196693,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":96,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[196738],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196697":{"id":196697,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":576,"y":0,"width":32,"height":32,"inputConnectorIDs":[196739],"outputSuccessConnectorIDs":[196700],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SMA Create Body of Email"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select \n'<html>'\n||'<style>'\n||'th,'\n||'td {font-family: arial; font-size: 9pt; width: 50%; border: 1px inset;},'\n||'table {font-family: arial; font-size: 9pt; width: 50%; border: 1px outset;}'\n||'</style>'\n||'<head><head>'\n||'<body style = \"font-family: arial; font-size: 9pt;\">'\n||'<h1 style = \"font-family: arial; font-size: 24pt;\">Nestlé Infant Nutrition Data Feeds Report</h1>'\n||'<h3 style = \"font-family: arial; font-size: 13.5pt;\">Feeds marked in red are more than two days overdue and need investigating.</h3>'\n||'</br>'\n||'<table><tr><th>Category</th><th>File</th><th>Frequency</th><th>Number of Files Last Month</th><th>Number of Files This Month</th><th>Days Since File Last Received</th><th>Date of Last File Successfully Loaded</th><th>Records Successfully Loaded</th></tr>'\n||listagg(\n             '<tr>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || category || '</td>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || latest_file || '</td>'\n             ||'<td style=\"text-align: left; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || frequency || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || files_last_month || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || files_this_month || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || days_since_last_file || '</td>'\n             ||'<td style=\"text-align: left; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || last_load_date || '</td>'\n             ||'<td style=\"text-align: right; width: 10%; vertical-align: middle;' || case when warning = 1 then 'color:red; font-weight:bold;' when warning = -1 then 'color:lightgrey;' else '' end || '\">' || records_loaded || '</td>'\n             ||'</tr>',\n             ' '\n         )\n  WITHIN GROUP (\n                   order by case\n                                when Frequency = 'Inactive' then 1\n                                else 0\n                            end,\n                            case\n                                when Frequency = 'Weekly' then days_since_last_file - 7\n                                when Frequency in ('Monthly','Adhoc') then days_since_last_file - 31\n                                else days_since_last_file\n                            end desc,\n                            case\n                                when Frequency = 'Daily' then 1\n                                when Frequency = 'Weekly' then 2\n                                when Frequency = 'Monthly' then 3\n                                when Frequency = 'Adhoc' then 4\n                                else 5\n                            end,\n                            category,\n                            latest_file\n               )\n||'</table>'\n||'</br></br>Please do not reply to this email as it comes from an automated account.</br></br>Thanks</body></html>'\nas email_body\nfrom (\n         select\n             *\n         from ${Database}.db.data_feeds_report\n         where client = 'SMA'\n     ) a"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"email_body"},"2":{"slot":2,"type":"STRING","value":"EMAIL_BODY"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196698":{"id":196698,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1841964130,"x":736,"y":0,"width":32,"height":32,"inputConnectorIDs":[196700],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SMA Data Feeds Report Email"}}}},"visible":true},"2":{"slot":2,"name":"from","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto@blueberrywave.com"}}}},"visible":true},"3":{"slot":3,"name":"from_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database} File Loader"}}}},"visible":true},"4":{"slot":4,"name":"html_body","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${email_body} "}}}},"visible":true},"5":{"slot":5,"name":"subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Nestlé Infant Nutrition Data Feeds Report"}}}},"visible":true},"6":{"slot":6,"name":"text_body","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"This is text body of email"}}}},"visible":true},"7":{"slot":7,"name":"to","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sma_data@blueberrywave.com"}}}},"visible":true},"8":{"slot":8,"name":"bcc","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" "}}}},"visible":true},"9":{"slot":9,"name":"cc","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" "}}}},"visible":true},"10":{"slot":10,"name":"replyto","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto@blueberrywave.com"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"196699":{"id":196699,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1841964130,"x":419,"y":2,"width":32,"height":32,"inputConnectorIDs":[196696],"outputSuccessConnectorIDs":[196739],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Nestle Data Feeds Report Email"}}}},"visible":true},"2":{"slot":2,"name":"from","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto@blueberrywave.com"}}}},"visible":true},"3":{"slot":3,"name":"from_name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Database} File Loader"}}}},"visible":true},"4":{"slot":4,"name":"html_body","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${email_body} "}}}},"visible":true},"5":{"slot":5,"name":"subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Purina & Nestle Data Feeds Report"}}}},"visible":true},"6":{"slot":6,"name":"text_body","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"This is text body of email"}}}},"visible":true},"7":{"slot":7,"name":"to","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"np_data@blueberrywave.com"}}}},"visible":true},"8":{"slot":8,"name":"bcc","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" "}}}},"visible":true},"9":{"slot":9,"name":"cc","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" "}}}},"visible":true},"10":{"slot":10,"name":"replyto","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto@blueberrywave.com"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"196696":{"id":196696,"sourceID":196692,"targetID":196699},"196700":{"id":196700,"sourceID":196697,"targetID":196698},"196739":{"id":196739,"sourceID":196699,"targetID":196697}},"failureConnectors":{},"unconditionalConnectors":{"196738":{"id":196738,"sourceID":196693,"targetID":196692}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"email_body":{"definition":{"name":"email_body","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"Data Feed Report Email","description":null,"type":"ORCHESTRATION","tag":"ba85e656-aaf6-45c3-9817-166bf36e3245"}}